<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GSS DEBUG</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; font-size: 14px; }
    .debug { background: #222; padding: 15px; border-radius: 8px; margin: 10px 0; }
    .debug pre { white-space: pre-wrap; font-size: 12px; margin: 5px 0; }
    button { padding: 10px 15px; background: #4e6ef2; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
    button:hover { background: #7c4ef2; }
    .status { font-weight: bold; }
    .ok { color: #0f0; }
    .error { color: #f44; }
  </style>
</head>
<body>

<h1>üîç –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê GSS</h1>

<div class="debug">
  <h3>GitHub –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:</h3>
  <button onclick="showConfig()">üìã –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥</button>
  <button onclick="testConfig()">üß™ –¢–µ—Å—Ç –∫–æ–Ω—Ñ—ñ–≥—É</button>
  <pre id="configInfo"></pre>
</div>

<div class="debug">
  <h3>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:</h3>
  <button onclick="loadDataDebug()">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ data.json</button>
  <button onclick="showDB()">üìä –ü–æ–∫–∞–∑–∞—Ç–∏ –±–∞–∑—É</button>
  <pre id="dataInfo"></pre>
</div>

<div class="debug">
  <h3>API —Ç–µ—Å—Ç:</h3>
  <button onclick="testAPI()">üåê –¢–µ—Å—Ç GitHub API</button>
  <pre id="apiInfo"></pre>
</div>

<script>
let GH = { owner: '', repo: '', token: '' };
let DB = {};

function showConfig() {
  const saved = localStorage.getItem('gss_gh');
  const cfg = saved ? JSON.parse(saved) : {};
  document.getElementById('configInfo').textContent = JSON.stringify(cfg, null, 2);
}

async function testConfig() {
  const info = document.getElementById('configInfo');
  const saved = localStorage.getItem('gss_gh');
  
  if (!saved) {
    info.textContent = '‚ùå –ö–æ–Ω—Ñ—ñ–≥ –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!';
    return;
  }
  
  GH = JSON.parse(saved);
  
  const test = {
    owner: GH.owner || '‚ùå –ü–£–°–¢–ò–ô',
    repo: GH.repo || '‚ùå –ü–£–°–¢–ò–ô', 
    token: GH.token ? '‚úÖ –Ñ (' + GH.token.slice(0,10) + '...' + GH.token.slice(-4) + ')' : '‚ùå –ü–£–°–¢–ò–ô'
  };
  
  info.textContent = JSON.stringify(test, null, 2);
  info.parentElement.className = 'debug ok';
}

async function testAPI() {
  const info = document.getElementById('apiInfo');
  
  if (!GH.owner || !GH.repo || !GH.token) {
    info.textContent = '‚ùå –°–ø–æ—á–∞—Ç–∫—É –Ω–∞–ª–∞—à—Ç—É–π –∫–æ–Ω—Ñ—ñ–≥!';
    info.parentElement.className = 'debug error';
    return;
  }
  
  try {
    const url = `https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/data.json`;
    const res = await fetch(url, {
      headers: { 
        'Authorization': `token ${GH.token}`, 
        'Accept': 'application/vnd.github.v3+json'
      }
    });
    
    if (!res.ok) {
      info.textContent = `‚ùå HTTP ${res.status}: ${res.statusText}`;
      info.parentElement.className = 'debug error';
      return;
    }
    
    const json = await res.json();
    const content = json.content ? atob(json.content.replace(/\n/g, '')) : '‚ùå –§–∞–π–ª –ø–æ—Ä–æ–∂–Ω—ñ–π';
    
    info.textContent = `‚úÖ API OK!\nSHA: ${json.sha?.slice(0,10)}...\nContent: ${content.slice(0,200)}...`;
    info.parentElement.className = 'debug ok';
    
  } catch(e) {
    info.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${e.message}`;
    info.parentElement.className = 'debug error';
  }
}

async function loadDataDebug() {
  const info = document.getElementById('dataInfo');
  
  if (!GH.owner || !GH.repo || !GH.token) {
    info.textContent = '‚ùå –°–ø–æ—á–∞—Ç–∫—É –Ω–∞–ª–∞—à—Ç—É–π –∫–æ–Ω—Ñ—ñ–≥!';
    return;
  }
  
  try {
    const url = `https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/data.json?ts=${Date.now()}`;
    const res = await fetch(url, {
      headers: { 
        'Authorization': `token ${GH.token}`, 
        'Accept': 'application/vnd.github.v3+json',
        'Cache-Control': 'no-cache'
      }
    });
    
    const json = await res.json();
    DB = JSON.parse(atob(json.content.replace(/\n/g, '')));
    
    const stats = {
      total: Object.values(DB).flatMap(m => Object.keys(m)).length,
      'GSS 1': Object.keys(DB['GSS 1'] || {}).length,
      'GSS 2': Object.keys(DB['GSS 2'] || {}).length,
      'GSS 3': Object.keys(DB['GSS 3'] || {}).length
    };
    
    info.textContent = `‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!\n${JSON.stringify(stats, null, 2)}`;
    info.parentElement.className = 'debug ok';
    
  } catch(e) {
    info.textContent = `‚ùå ${e.message}`;
    info.parentElement.className = 'debug error';
  }
}

function showDB() {
  const info = document.getElementById('dataInfo');
  info.textContent = JSON.stringify(DB, null, 2);
}
</script>

<div style="margin-top: 40px; padding: 20px; background: #333; border-radius: 8px;">
  <h3>üìã –©–æ —Ä–æ–±–∏—Ç–∏:</h3>
  <ol>
    <li><strong>F12 ‚Üí Console</strong> ‚Äî –¥–∏–≤–∏—Å—å —á–∏ —î –ø–æ–º–∏–ª–∫–∏</li>
    <li><strong>üìã –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥</strong> ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ</li>
    <li><strong>üß™ –¢–µ—Å—Ç –∫–æ–Ω—Ñ—ñ–≥—É</strong> ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä —á–∏ —î —Ç–æ–∫–µ–Ω</li>
    <li><strong>üåê –¢–µ—Å—Ç GitHub API</strong> ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä —á–∏ –±–∞—á–∏—Ç—å data.json</li>
    <li><strong>üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ data.json</strong> ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä —á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è —Ñ–∞–π–ª</li>
    <li><strong>üìä –ü–æ–∫–∞–∑–∞—Ç–∏ –±–∞–∑—É</strong> ‚Äî –ø–æ–¥–∏–≤–∏—Å—å —â–æ –≤ –±–∞–∑—ñ</li>
  </ol>
  <p><strong>–°–∫–æ–ø—ñ—é–π –í–°–Ü —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏** —ñ –ø—Ä–∏—à–ª–∏ –º–µ–Ω—ñ!</strong></p>
</div>

</body>
</html>
