<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>GSS Panewki</title>
  <style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  input, select, textarea { font-size: 16px !important; }
  button, input, .dropdown-item, .machine-btn, .fab, .config-bar summary {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #0f1117;
    color: #e0e0e0;
    min-height: 100vh;
    padding: 24px 16px 80px;
  }
  h1 {
    text-align: center;
    font-size: clamp(1.1rem, 4vw, 1.7rem);
    letter-spacing: 2px;
    color: #fff;
    margin-bottom: 24px;
    text-transform: uppercase;
  }
  .machine-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 28px; flex-wrap: wrap; }
  .machine-btn {
    padding: 12px 0; width: clamp(90px, 28vw, 150px);
    border: 2px solid #2e2e3e; border-radius: 12px;
    background: #1a1b26; color: #aaa;
    font-size: clamp(0.9rem, 3.5vw, 1rem); font-weight: 600;
    cursor: pointer; letter-spacing: 1px; text-align: center;
    transition: border-color 0.15s, color 0.15s;
  }
  .machine-btn.active { background: #4e6ef2; border-color: #4e6ef2; color: #fff; box-shadow: 0 0 18px rgba(78,110,242,0.4); }
  .machine-btn:active { transform: scale(0.96); background: #3a5ce0; border-color: #3a5ce0; color: #fff; }

  .search-wrap { max-width: 520px; margin: 0 auto 28px; position: relative; }
  .search-wrap input { width: 100%; padding: 14px 18px; border-radius: 12px; border: 2px solid #2e2e3e; background: #1a1b26; color: #fff; outline: none; transition: border-color 0.2s; }
  .search-wrap input:focus { border-color: #4e6ef2; }
  .search-wrap input::placeholder { color: #555; }
  .search-wrap input:disabled { opacity: 0.4; cursor: not-allowed; }

  .dropdown { position: absolute; top: calc(100% + 6px); left: 0; right: 0; background: #1e1f2e; border: 1px solid #2e2e3e; border-radius: 12px; z-index: 100; box-shadow: 0 8px 30px rgba(0,0,0,0.5); max-height: 260px; overflow-y: auto; }
  .dropdown:empty { display: none; }
  .dropdown-item { padding: 13px 18px; cursor: pointer; color: #ccc; border-bottom: 1px solid #25263a; display: flex; align-items: center; gap: 10px; transition: background 0.1s; }
  .dropdown-item:last-child { border-bottom: none; }
  .dropdown-item:active { background: #2a2b40; color: #fff; }
  .match-highlight { color: #4e6ef2; font-weight: 700; }
  .dim-info { margin-left: auto; font-size: 0.78rem; color: #555; }
  .dropdown-empty { padding: 14px 18px; color: #e05252; font-size: 0.95rem; text-align: center; }
  .dropdown::-webkit-scrollbar { width: 5px; }
  .dropdown::-webkit-scrollbar-track { background: #1e1f2e; }
  .dropdown::-webkit-scrollbar-thumb { background: #3a3b55; border-radius: 4px; }

  .hint { text-align: center; color: #555; margin-top: 40px; font-size: clamp(0.85rem, 3vw, 0.95rem); }

  .results { max-width: 520px; margin: 0 auto 24px; }
  .card { background: #1a1b26; border: 1px solid #2e2e3e; border-radius: 16px; padding: 22px 20px 20px; position: relative; overflow: hidden; animation: fadeIn 0.25s ease; }
  @keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:none; } }
  .card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: linear-gradient(180deg, #4e6ef2, #7c4ef2); border-radius: 16px 0 0 16px; }
  .card-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .card-id { font-size: clamp(1.1rem, 4vw, 1.3rem); font-weight: 700; color: #4e6ef2; letter-spacing: 1px; }
  .card-machine { font-size: 0.78rem; color: #666; margin-top: 3px; }
  .bushing-icon { width: 60px; height: 44px; flex-shrink: 0; }

  .info-row { display: flex; gap: 10px; margin-bottom: 14px; flex-wrap: wrap; }
  .info-pill { background: #12131d; border-radius: 8px; padding: 8px 14px; font-size: clamp(0.75rem, 2.8vw, 0.85rem); color: #aab4cc; border: 1px solid #2a2b3a; flex: 1; min-width: 100px; text-align: center; }
  .info-pill span { display: block; color: #fff; font-weight: 700; font-size: clamp(0.88rem, 3.2vw, 1rem); margin-top: 4px; }

  .colors-section { margin-bottom: 18px; }
  .colors-label { font-size: 0.8rem; color: #8a8aaa; margin-bottom: 8px; }
  .color-row { display: flex; align-items: center; gap: 10px; background: #12131d; border: 1px solid #2a2b3a; border-radius: 10px; padding: 10px 14px; margin-bottom: 6px; }
  .color-dot { width: 14px; height: 14px; border-radius: 50%; flex-shrink: 0; border: 2px solid rgba(255,255,255,0.15); }
  .color-name { font-size: 0.9rem; color: #ccc; flex: 1; }
  .color-thick { font-size: 0.9rem; font-weight: 700; color: #fff; }

  .angles { display: flex; gap: 10px; margin-bottom: 14px; }
  .angle-box { flex: 1; background: #12131d; border: 1px solid #2a2b3a; border-radius: 12px; padding: 14px 8px; text-align: center; }
  .angle-deg { font-size: clamp(0.9rem, 3.5vw, 1rem); font-weight: 700; color: #f0c060; margin-bottom: 8px; }
  .angle-val { font-size: clamp(1.1rem, 4.5vw, 1.4rem); font-weight: 800; color: #fff; }

  .card-actions { display: flex; gap: 8px; margin-top: 16px; }
  .btn-edit, .btn-delete { flex: 1; padding: 10px; border-radius: 10px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: opacity 0.15s; }
  .btn-edit   { background: #1e3a5f; color: #60a5fa; border: 1px solid #2563eb; }
  .btn-delete { background: #3b1515; color: #f87171; border: 1px solid #dc2626; }
  .btn-edit:active   { opacity: 0.65; transform: scale(0.97); }
  .btn-delete:active { opacity: 0.65; transform: scale(0.97); }

  .fab { position: fixed; bottom: 28px; width: 58px; height: 58px; border-radius: 50%; border: none; color: #fff; font-size: 1.6rem; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 200; transition: transform 0.15s; }
  .fab:active { transform: scale(0.91); box-shadow: none !important; }
  .fab-add { right: 22px; background: linear-gradient(135deg, #4e6ef2, #7c4ef2); box-shadow: 0 4px 20px rgba(78,110,242,0.5); }

  .config-bar { max-width: 520px; margin: 0 auto 18px; background: #1a1b26; border: 1px dashed #2e2e3e; border-radius: 12px; padding: 14px 16px; }
  .config-bar summary { cursor: pointer; color: #555; font-size: 0.82rem; letter-spacing: 0.5px; user-select: none; transition: color 0.15s; }
  .config-bar summary:active { color: #aaa; }
  .config-fields { display: flex; flex-direction: column; gap: 8px; margin-top: 12px; }
  .config-fields input { padding: 9px 13px; border-radius: 8px; border: 1.5px solid #2e2e3e; background: #12131d; color: #fff; outline: none; transition: border-color 0.2s; }
  .config-fields input:focus { border-color: #4e6ef2; }
  .btn-config-save { padding: 9px; border-radius: 8px; border: none; background: #4e6ef2; color: #fff; font-size: 0.88rem; font-weight: 600; cursor: pointer; }
  .btn-config-save:active { opacity: 0.7; transform: scale(0.97); }

  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 300; align-items: center; justify-content: center; padding: 16px; }
  .modal-overlay.open { display: flex; }
  .modal { position: relative; background: #1a1b26; border: 1px solid #2e2e3e; border-radius: 18px; padding: 28px 24px; width: 100%; max-width: 440px; animation: fadeIn 0.2s ease; max-height: 90vh; overflow-y: auto; }
  .modal h2 { font-size: 1.15rem; color: #fff; margin-bottom: 6px; }
  .modal-machine { font-size: 0.82rem; color: #4e6ef2; margin-bottom: 20px; }
  .form-group { margin-bottom: 14px; }
  .form-group label { display: block; font-size: 0.82rem; color: #8a8aaa; margin-bottom: 5px; }
  .form-group input { width: 100%; padding: 11px 14px; border-radius: 10px; border: 1.5px solid #2e2e3e; background: #12131d; color: #fff; outline: none; transition: border-color 0.2s; }
  .form-group input:focus { border-color: #4e6ef2; }
  .prices-row { display: flex; gap: 8px; }
  .prices-row .form-group { flex: 1; }
  .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
  .btn-cancel { flex: 1; padding: 12px; border-radius: 10px; border: 1.5px solid #2e2e3e; background: transparent; color: #aaa; font-size: 0.95rem; cursor: pointer; }
  .btn-cancel:active { border-color: #aaa; color: #fff; transform: scale(0.97); }
  .btn-save { flex: 2; padding: 12px; border-radius: 10px; border: none; background: linear-gradient(135deg, #4e6ef2, #7c4ef2); color: #fff; font-size: 0.95rem; font-weight: 700; cursor: pointer; }
  .btn-save:active { opacity: 0.75; transform: scale(0.98); }
  .btn-save:disabled { opacity: 0.4; cursor: not-allowed; }

  .section-divider { font-size: 0.78rem; color: #4e6ef2; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; margin: 18px 0 10px; padding-bottom: 6px; border-bottom: 1px solid #2e2e3e; }

  /* Palette */
  .colors-editor-label { font-size: 0.82rem; color: #8a8aaa; margin-bottom: 10px; display: block; }
  .color-palette { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
  .palette-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 10px; border-radius: 10px; border: 2px solid #2e2e3e; background: #12131d; color: #ccc; font-size: 0.75rem; cursor: pointer; transition: border-color 0.15s, transform 0.1s; min-width: 54px; }
  .palette-btn:active { transform: scale(0.93); }
  .palette-btn.selected { border-color: #4e6ef2; color: #fff; background: #1a1f3a; }
  .palette-dot { width: 22px; height: 22px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.15); flex-shrink: 0; }
  .palette-btn-add { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 10px; border-radius: 10px; border: 2px dashed #2e2e3e; background: transparent; color: #555; font-size: 0.75rem; cursor: pointer; transition: border-color 0.15s, color 0.15s; min-width: 54px; }
  .palette-btn-add:active { border-color: #4e6ef2; color: #4e6ef2; transform: scale(0.93); }
  .palette-add-icon { font-size: 1.2rem; line-height: 22px; }

  .custom-color-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 600; align-items: center; justify-content: center; padding: 16px; }
  .custom-color-overlay.open { display: flex; }
  .custom-color-box { position: relative; background: #1a1b26; border: 1px solid #2e2e3e; border-radius: 16px; padding: 24px; width: 100%; max-width: 320px; animation: fadeIn 0.2s ease; }
  .custom-color-box h3 { color: #fff; font-size: 1rem; margin-bottom: 16px; }
  .color-preview-row { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
  .color-preview-circle { width: 40px; height: 40px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); flex-shrink: 0; }
  .color-preview-row input[type="color"] { width: 48px; height: 40px; padding: 2px; border-radius: 8px; border: 1.5px solid #2e2e3e; background: #12131d; cursor: pointer; }
  .custom-color-actions { display: flex; gap: 10px; margin-top: 16px; }
  .btn-custom-cancel { flex: 1; padding: 10px; border-radius: 10px; border: 1.5px solid #2e2e3e; background: transparent; color: #aaa; cursor: pointer; }
  .btn-custom-ok { flex: 1; padding: 10px; border-radius: 10px; border: none; background: #4e6ef2; color: #fff; font-weight: 700; cursor: pointer; }

  .color-entry { background: #12131d; border: 1px solid #2a2b3a; border-radius: 10px; padding: 10px 12px; margin-bottom: 8px; }
  .color-entry-top { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
  .color-entry-dot { width: 16px; height: 16px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.15); flex-shrink: 0; }
  .color-entry-name { font-size: 0.9rem; color: #fff; flex: 1; font-weight: 600; }
  .btn-remove-color { background: #3b1515; color: #f87171; border: 1px solid #dc2626; border-radius: 8px; padding: 5px 10px; cursor: pointer; font-size: 0.8rem; }
  .btn-remove-color:active { opacity: 0.7; }
  .color-entry-thick { display: flex; align-items: center; gap: 8px; }
  .color-entry-thick label { font-size: 0.8rem; color: #8a8aaa; white-space: nowrap; }
  .color-entry-thick input { flex: 1; padding: 8px 12px; border-radius: 8px; border: 1.5px solid #2e2e3e; background: #0f1117; color: #fff; outline: none; }
  .color-entry-thick input:focus { border-color: #4e6ef2; }

  .confirm-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 500; align-items: center; justify-content: center; padding: 16px; }
  .confirm-overlay.open { display: flex; }
  .confirm-box { position: relative; background: #1a1b26; border: 1px solid #dc2626; border-radius: 16px; padding: 28px 24px; width: 100%; max-width: 360px; text-align: center; animation: fadeIn 0.2s ease; }
  .confirm-box h3 { color: #f87171; font-size: 1.1rem; margin-bottom: 10px; }
  .confirm-box p  { color: #aaa; font-size: 0.9rem; margin-bottom: 22px; }
  .confirm-box strong { color: #fff; }
  .confirm-actions { display: flex; gap: 10px; }
  .btn-confirm-cancel { flex: 1; padding: 11px; border-radius: 10px; border: 1.5px solid #2e2e3e; background: transparent; color: #aaa; cursor: pointer; }
  .btn-confirm-cancel:active { color: #fff; border-color: #aaa; transform: scale(0.97); }
  .btn-confirm-delete { flex: 1; padding: 11px; border-radius: 10px; border: none; background: #dc2626; color: #fff; font-weight: 700; cursor: pointer; }
  .btn-confirm-delete:active { background: #b91c1c; transform: scale(0.97); }

  .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1e1f2e; border: 1px solid #2e2e3e; border-radius: 12px; padding: 12px 22px; color: #fff; font-size: 0.9rem; z-index: 400; opacity: 0; transition: opacity 0.3s; white-space: nowrap; pointer-events: none; }
  .toast.show    { opacity: 1; }
  .toast.success { border-color: #10b981; color: #10b981; }
  .toast.error   { border-color: #e05252; color: #e05252; }
    .delete-color-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px; border-radius: 10px;
  border: 2px solid #2e2e3e; background: #12131d;
  cursor: pointer; transition: border-color 0.15s;
}
.delete-color-item:active { transform: scale(0.97); }
.delete-color-item.selected { border-color: #dc2626; background: #2a1010; }
.delete-color-item-dot { width: 18px; height: 18px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.15); flex-shrink: 0; }
.delete-color-item-name { font-size: 0.9rem; color: #ccc; flex: 1; }

    .modal-close-btn {
  position: absolute; top: 16px; right: 16px;
  width: 34px; height: 34px; border-radius: 50%;
  border: 1.5px solid #2e2e3e; background: #12131d;
  color: #aaa; font-size: 1.1rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background 0.15s, color 0.15s;
  z-index: 10; flex-shrink: 0;
}
.modal-close-btn:active { background: #2e2e3e; color: #fff; transform: scale(0.93); }


  </style>
</head>
<body>

<h1>GSS</h1>

<details class="config-bar" id="configBar">
  <summary>‚öôÔ∏è Ustawienia (tylko dla administratora)</summary>
  <div class="config-fields">
    <input type="password" id="cfgToken" placeholder="GitHub Token (tylko dla admina)"/>
    <button class="btn-config-save" onclick="saveConfig()">üíæ Zapisz token</button>
  </div>
</details>

<div class="machine-selector">
  <button class="machine-btn" onclick="selectMachine('GSS 1', this)">GSS 1</button>
  <button class="machine-btn" onclick="selectMachine('GSS 2', this)">GSS 2</button>
  <button class="machine-btn" onclick="selectMachine('GSS 3', this)">GSS 3</button>
</div>

<div class="search-wrap" id="searchWrap">
  <input type="text" id="searchInput" autocomplete="off"
         placeholder="Najpierw wybierz maszynƒô..."
         oninput="handleInput(event)" disabled/>
  <div class="dropdown" id="dropdown"></div>
</div>

<div class="results" id="results">
  <p class="hint">Najpierw wybierz maszynƒô ‚Üë</p>
</div>

<button class="fab fab-add" onclick="openModal()" title="Dodaj numer">Ôºã</button>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADD MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <button class="modal-close-btn" onclick="closeModal()">‚úï</button>
    <h2>‚ûï Nowa panewka</h2>
    <p class="modal-machine" id="modalMachineName"></p>

    <div class="section-divider">Dane podstawowe</div>
    <div class="form-group">
      <label>Dziesiƒôciocyfr√≥wka</label>
      <input type="text" id="fNum" placeholder="np. 1402291079" autocomplete="off"/>
    </div>
    <div class="form-group">
      <label>≈örednica (mm)</label>
      <input type="number" id="fDiam" step="0.001" placeholder="np. 111.022"/>
    </div>

    <div class="section-divider">Warto≈õƒá dla kƒÖt√≥w</div>
    <div class="prices-row">
      <div class="form-group"><label>20¬∞</label><input type="number" id="fP20" step="0.1" min="0" max="99" placeholder="0.0"/></div>
      <div class="form-group"><label>25¬∞</label><input type="number" id="fP25" step="0.1" min="0" max="99" placeholder="0.0"/></div>
      <div class="form-group"><label>30¬∞</label><input type="number" id="fP30" step="0.1" min="0" max="99" placeholder="0.0"/></div>
    </div>

    <div class="section-divider">Tolerancje</div>
    <div class="form-group">
      <label>Tolerancja grubo≈õci (mm)</label>
      <input type="number" id="fTgDo" step="0.001" placeholder="np. 0.010"/>
    </div>
    <div class="form-group">
      <label>Tolerancja wsp√≥≈Ç≈õrodkowo≈õci (mm)</label>
      <div class="prices-row">
        <div class="form-group"><label>Od</label><input type="number" id="fTwOd" step="0.001" placeholder="-0.005"/></div>
        <div class="form-group"><label>Do</label><input type="number" id="fTwDo" step="0.001" placeholder="+0.005"/></div>
      </div>
    </div>
    <div class="form-group">
      <label>Tolerancja wysoko≈õci (mm)</label>
      <div class="prices-row">
        <div class="form-group"><label>Od</label><input type="number" id="fTyOd" step="0.001" placeholder="-0.008"/></div>
        <div class="form-group"><label>Do</label><input type="number" id="fTyDo" step="0.001" placeholder="+0.008"/></div>
      </div>
    </div>

    <div class="section-divider">Selekcje i grubo≈õci</div>
    <div style="display:flex;gap:8px;margin-bottom:10px;">
  <button type="button" class="palette-btn-add"
          style="flex:1;flex-direction:row;justify-content:center;gap:6px;padding:10px;"
          onclick="openCustomColor('fPalette','fColorsList')">
    <span style="font-size:1rem;">Ôºã</span><span>Nowa selekcja</span>
  </button>
  <button type="button" class="palette-btn-add"
          style="flex:1;flex-direction:row;justify-content:center;gap:6px;padding:10px;border-color:#dc2626;color:#f87171;"
          onclick="openDeleteColor()">
    <span style="font-size:1rem;">üóëÔ∏è</span><span>Usu≈Ñ selekcjƒô</span>
  </button>
</div>


    <div class="form-group">
      <label class="colors-editor-label">üé® Wybierz selekcje</label>
      <div class="color-palette" id="fPalette"></div>
      <div id="fColorsList"></div>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeModal()">Anuluj</button>
      <button class="btn-save" id="btnSave" onclick="saveEntry()">üíæ Zapisz</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EDIT MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="editModalOverlay">
  <div class="modal">
    <button class="modal-close-btn" onclick="closeModal()">‚úï</button>
    <h2>‚úèÔ∏è Edycja</h2>
    <p class="modal-machine" id="editModalMachine"></p>
    <input type="hidden" id="eOrigNum"/>

    <div class="section-divider">Dane podstawowe</div>
    <div class="form-group">
      <label>Dziesiƒôciocyfr√≥wka</label>
      <input type="text" id="eNum" autocomplete="off"/>
    </div>
    <div class="form-group">
      <label>≈örednica (mm)</label>
      <input type="number" id="eDiam" step="0.001"/>
    </div>

    <div class="section-divider">Warto≈õƒá dla kƒÖt√≥w</div>
    <div class="prices-row">
      <div class="form-group"><label>20¬∞</label><input type="number" id="eP20" step="0.1" min="0" max="99"/></div>
      <div class="form-group"><label>25¬∞</label><input type="number" id="eP25" step="0.1" min="0" max="99"/></div>
      <div class="form-group"><label>30¬∞</label><input type="number" id="eP30" step="0.1" min="0" max="99"/></div>
    </div>

    <div class="section-divider">Tolerancje</div>
    <div class="form-group">
      <label>Tolerancja grubo≈õci (mm)</label>
      <div class="prices-row">
        <div class="form-group"><label>Od</label><input type="number" id="eTgOd" step="0.001"/></div>
        <div class="form-group"><label>Do</label><input type="number" id="eTgDo" step="0.001"/></div>
      </div>
    </div>
    <div class="form-group">
      <label>Tolerancja wsp√≥≈Ç≈õrodkowo≈õci (mm)</label>
      <div class="prices-row">
        <div class="form-group"><label>Od</label><input type="number" id="eTwOd" step="0.001"/></div>
        <div class="form-group"><label>Do</label><input type="number" id="eTwDo" step="0.001"/></div>
      </div>
    </div>
    <div class="form-group">
      <label>Tolerancja wysoko≈õci (mm)</label>
      <div class="prices-row">
        <div class="form-group"><label>Od</label><input type="number" id="eTyOd" step="0.001"/></div>
        <div class="form-group"><label>Do</label><input type="number" id="eTyDo" step="0.001"/></div>
      </div>
    </div>

    <div class="section-divider">Selekcje i grubo≈õci</div>
    <div style="display:flex;gap:8px;margin-bottom:10px;">
  <button type="button" class="palette-btn-add"
          style="flex:1;flex-direction:row;justify-content:center;gap:6px;padding:10px;"
          onclick="openCustomColor('ePalette','eColorsList')">
    <span style="font-size:1rem;">Ôºã</span><span>Nowa selekcja</span>
  </button>
  <button type="button" class="palette-btn-add"
          style="flex:1;flex-direction:row;justify-content:center;gap:6px;padding:10px;border-color:#dc2626;color:#f87171;"
          onclick="openDeleteColor()">
    <span style="font-size:1rem;">üóëÔ∏è</span><span>Usu≈Ñ selekcjƒô</span>
  </button>
</div>


    <div class="form-group">
      <label class="colors-editor-label">üé® Wybierz selekcje</label>
      <div class="color-palette" id="ePalette"></div>
      <div id="eColorsList"></div>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" onclick="closeEditModal()">Anuluj</button>
      <button class="btn-save" id="btnEditSave" onclick="saveEdit()">üíæ Zapisz zmiany</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DELETE CONFIRM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-box">
    <button class="modal-close-btn" onclick="closeConfirm()">‚úï</button>
    <h3>üóëÔ∏è UsunƒÖƒá wpis?</h3>
    <p>Numer <strong id="confirmNum"></strong> zostanie usuniƒôty z <strong id="confirmMachine"></strong>. Tej operacji nie mo≈ºna cofnƒÖƒá.</p>
    <div class="confirm-actions">
      <button class="btn-confirm-cancel" onclick="closeConfirm()">Anuluj</button>
      <button class="btn-confirm-delete" onclick="confirmDelete()">Usu≈Ñ</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CUSTOM COLOR MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="custom-color-overlay" id="deleteColorOverlay">
  <div class="custom-color-box" style="max-width:360px;">
    <button class="modal-close-btn" onclick="closeDeleteColor()">‚úï</button>
    <h3>üóëÔ∏è Usu≈Ñ selekcjƒô</h3>
    <p style="color:#8a8aaa;font-size:0.85rem;margin-bottom:14px;">Wybierz selekcjƒô do usuniƒôcia:</p>
    <div id="deleteColorList" style="display:flex;flex-direction:column;gap:8px;max-height:260px;overflow-y:auto;margin-bottom:16px;"></div>
    <div class="custom-color-actions">
      <button class="btn-custom-cancel" onclick="closeDeleteColor()">Anuluj</button>
      <button class="btn-custom-ok" id="btnConfirmDeleteColor"
              onclick="confirmDeleteColor()"
              style="background:#dc2626;" disabled>üóëÔ∏è Usu≈Ñ</button>
    </div>
  </div>
</div>
<div class="custom-color-overlay" id="customColorOverlay">
  <div class="custom-color-box">
    <button class="modal-close-btn" onclick="closeCustomColor()">‚úï</button>
    <h3>‚ûï Nowa selekcja</h3>
    <div class="color-preview-row">
      <div class="color-preview-circle" id="customColorPreview" style="background:#888888"></div>
      <input type="color" id="customColorPicker" value="#888888"
             oninput="document.getElementById('customColorPreview').style.background=this.value"/>
    </div>
    <div class="form-group">
      <label>Nazwa selekcji</label>
      <input type="text" id="customColorName" placeholder="np. Pomara≈Ñczowy" autocomplete="off"/>
    </div>
    <div class="custom-color-actions">
      <button class="btn-custom-cancel" onclick="closeCustomColor()">Anuluj</button>
      <button class="btn-custom-ok"     onclick="confirmCustomColor()">‚úÖ Dodaj</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  const REPO_OWNER = 'Vitalii-Kravchenko';
  const REPO_NAME  = 'gss';

  let PALETTE = [];

  let token = localStorage.getItem('gss_token') || '';
  let DB = {};
  let currentMachine = null;
  let _activePaletteId = null;
  let _customTarget    = null;

  // ‚îÄ‚îÄ Config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function saveConfig() {
    token = document.getElementById('cfgToken').value.trim();
    localStorage.setItem('gss_token', token);
    showToast('‚úÖ Token zapisany', 'success');
    document.getElementById('configBar').removeAttribute('open');
  }

  // ‚îÄ‚îÄ Load / Save ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function loadData() {
  try {
    const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/data.json`;
    const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github.v3+json' } });
    if (!res.ok) throw new Error();
    const json = await res.json();
    const parsed = JSON.parse(decodeURIComponent(escape(atob(json.content.replace(/\n/g, '')))));

    // –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–∞–ª—ñ—Ç—Ä—É –∑ —Ñ–∞–π–ª—É —è–∫—â–æ —î
    if (parsed._palette && parsed._palette.length) {
      PALETTE = parsed._palette;
    }

    // –∫–æ–ø—ñ—é—î–º–æ —Ç—ñ–ª—å–∫–∏ –º–∞—à–∏–Ω–∏
    DB = {};
    ['GSS 1', 'GSS 2', 'GSS 3'].forEach(m => {
      DB[m] = parsed[m] || {};
    });

  } catch {
    DB = { "GSS 1": {}, "GSS 2": {}, "GSS 3": {} };
    showToast('‚ö†Ô∏è Nie uda≈Ço siƒô za≈Çadowaƒá danych', 'error');
  }
}


  async function saveData() {
  if (!token) { showToast('‚ö†Ô∏è Wprowad≈∫ token w ustawieniach', 'error'); return false; }
  try {
    const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/data.json`;
    const getRes  = await fetch(apiUrl, {
      headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' }
    });
    const getJson = await getRes.json();
    if (!getRes.ok) throw new Error(getJson.message);

    // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —ñ –ø–∞–ª—ñ—Ç—Ä—É —ñ –º–∞—à–∏–Ω–∏ —Ä–∞–∑–æ–º
    const payload = { _palette: PALETTE, ...DB };
    const content = btoa(unescape(encodeURIComponent(JSON.stringify(payload, null, 2))));

    const putRes = await fetch(apiUrl, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ message: 'Update data.json via GSS app', content, sha: getJson.sha })
    });
    if (!putRes.ok) { const e = await putRes.json(); throw new Error(e.message); }
    return true;
  } catch { return false; }
}


  // ‚îÄ‚îÄ Machine ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function selectMachine(machine, btn) {
    currentMachine = machine;
    document.querySelectorAll('.machine-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const inp = document.getElementById('searchInput');
    inp.disabled = false; inp.value = '';
    inp.placeholder = `Szukaj numeru w ${machine}...`;
    inp.focus();
    document.getElementById('dropdown').innerHTML = '';
    document.getElementById('results').innerHTML = '<p class="hint">Wpisz numer, aby wyszukaƒá</p>';
  }

  // ‚îÄ‚îÄ Search ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function handleInput(e) {
    const query = e.target.value.trim();
    const dropdown = document.getElementById('dropdown');
    document.getElementById('results').innerHTML = '';
    dropdown.innerHTML = '';
    if (!query) { document.getElementById('results').innerHTML = '<p class="hint">Wpisz numer, aby wyszukaƒá</p>'; return; }

    const matched = Object.entries(DB[currentMachine] || {})
      .filter(([id]) => id.toLowerCase().startsWith(query.toLowerCase()));

    if (!matched.length) { dropdown.innerHTML = `<div class="dropdown-empty">‚ùå Numer "${query}" nie istnieje w bazie</div>`; return; }

    matched.forEach(([id, item]) => {
      const div = document.createElement('div');
      div.className = 'dropdown-item';
      div.innerHTML = `
        <span># <span class="match-highlight">${id.slice(0, query.length)}</span>${id.slice(query.length)}</span>
        <span class="dim-info">‚åÄ${item.diameter} ¬∑ ${(item.colors||[]).length} sel.</span>
      `;
      div.addEventListener('click', () => selectResult(id, item));
      dropdown.appendChild(div);
    });
  }

  // ‚îÄ‚îÄ Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function selectResult(id, item) {
    document.getElementById('dropdown').innerHTML = '';
    document.getElementById('searchInput').value = id;

    const colors = item.colors || [];
    const tol    = item.tolerancje || {};

    const colorsHTML = colors.length ? `
      <div class="colors-section">
        <div class="colors-label">üé® Selekcje i grubo≈õci</div>
        ${colors.map(c => `
          <div class="color-row">
            <div class="color-dot" style="background:${c.color}"></div>
            <div class="color-name">${c.name}</div>
            <div class="color-thick">${c.thickness} mm</div>
          </div>`).join('')}
      </div>` : '';

    const fmt = (v) => v !== undefined && v !== '' ? v : '‚Äî';
    const tolHTML = `
      <div class="info-row">
        <div class="info-pill">Tol. grubo≈õci<span>${tol.grubosc ? fmt(tol.grubosc.do)+' mm' : '‚Äî'}</span></div>
        <div class="info-pill">Tol. wsp.≈õrod.<span>${tol.wspolsrodkowosc ? fmt(tol.wspolsrodkowosc.od)+' / '+fmt(tol.wspolsrodkowosc.do)+' mm' : '‚Äî'}</span></div>
        <div class="info-pill">Tol. wysoko≈õci<span>${tol.wysokosc ? fmt(tol.wysokosc.od)+' / '+fmt(tol.wysokosc.do)+' mm' : '‚Äî'}</span></div>
      </div>`;

    const anglesHTML = [20,25,30].map((deg,i) => `
      <div class="angle-box">
        <div class="angle-deg">${deg}¬∞</div>
        <div class="angle-val">${parseFloat(item.prices[i]).toFixed(1)}</div>
      </div>`).join('');

    const actionsHTML = token ? `
      <div class="card-actions">
        <button class="btn-edit"   onclick="openEditModal('${id}')">‚úèÔ∏è Edytuj</button>
        <button class="btn-delete" onclick="openConfirm('${id}')">üóëÔ∏è Usu≈Ñ</button>
      </div>` : '';

    document.getElementById('results').innerHTML = `
      <div class="card">
        <div class="card-top">
          <div><div class="card-id"># ${id}</div><div class="card-machine">${currentMachine}</div></div>
          ${bushingIcon()}
        </div>
        <div class="info-row">
          <div class="info-pill">≈örednica panewki<span>${item.diameter} mm</span></div>
        </div>
        ${colorsHTML}
        ${tolHTML}
        <div class="angles">${anglesHTML}</div>
        ${actionsHTML}
      </div>`;
  }

  // ‚îÄ‚îÄ Palette ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderPalette(paletteId, colorsListId, selectedColors) {
    _activePaletteId = paletteId;
    const container  = document.getElementById(paletteId);
    container.innerHTML = '';

    PALETTE.forEach((p, i) => {
      const selected = (selectedColors || []).some(c => c.name === p.name);
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'palette-btn' + (selected ? ' selected' : '');
      btn.dataset.index = i;
      btn.innerHTML = `<div class="palette-dot" style="background:${p.color}"></div><span>${p.name}</span>`;
      btn.addEventListener('click', () => togglePaletteColor(i, paletteId, colorsListId));
      container.appendChild(btn);
    });

    const addBtn = document.createElement('button');
    addBtn.type = 'button';
    addBtn.className = 'palette-btn-add';
    addBtn.innerHTML = `<span class="palette-add-icon">Ôºã</span><span>Nowy</span>`;
    addBtn.addEventListener('click', () => openCustomColor(paletteId, colorsListId));
    container.appendChild(addBtn);
  }

  function togglePaletteColor(index, paletteId, colorsListId) {
    const p = PALETTE[index];
    const list = document.getElementById(colorsListId);
    const existing = list.querySelector(`[data-color-name="${p.name}"]`);
    if (existing) {
      existing.remove();
      document.querySelector(`#${paletteId} .palette-btn[data-index="${index}"]`)?.classList.remove('selected');
      return;
    }
    addColorEntry(colorsListId, p.name, p.color);
    document.querySelector(`#${paletteId} .palette-btn[data-index="${index}"]`)?.classList.add('selected');
  }

  function addColorEntry(colorsListId, name, color, thickness = '') {
    const list = document.getElementById(colorsListId);
    const div  = document.createElement('div');
    div.className = 'color-entry';
    div.dataset.colorName = name;
    div.dataset.colorHex  = color;
    const paletteId = colorsListId === 'fColorsList' ? 'fPalette' : 'ePalette';
    div.innerHTML = `
      <div class="color-entry-top">
        <div class="color-entry-dot" style="background:${color}"></div>
        <div class="color-entry-name">${name}</div>
        <button class="btn-remove-color" onclick="removeColorEntry(this,'${paletteId}','${colorsListId}')">‚úï</button>
      </div>
      <div class="color-entry-thick">
        <label>Grubo≈õƒá (mm):</label>
        <input type="number" step="0.001" placeholder="np. 3.474" value="${thickness}"/>
      </div>`;
    list.appendChild(div);
  }

  function removeColorEntry(btn, paletteId, colorsListId) {
    const entry = btn.closest('.color-entry');
    const name  = entry.dataset.colorName;
    entry.remove();
    document.querySelectorAll(`#${paletteId} .palette-btn`).forEach(b => {
      const i = parseInt(b.dataset.index);
      if (!isNaN(i) && PALETTE[i]?.name === name) b.classList.remove('selected');
    });
  }

  function getColorsFromList(colorsListId) {
    const result = [];
    for (const entry of document.querySelectorAll(`#${colorsListId} .color-entry`)) {
      const thickness = parseFloat(entry.querySelector('input[type="number"]').value);
      if (!entry.dataset.colorName || isNaN(thickness)) return null;
      result.push({ name: entry.dataset.colorName, color: entry.dataset.colorHex, thickness });
    }
    return result;
  }

  // ‚îÄ‚îÄ Custom color ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openCustomColor(paletteId, colorsListId) {
  _customTarget = { paletteId, colorsListId };
  document.getElementById('customColorName').value = '';
  document.getElementById('customColorPicker').value = '#888888';
  document.getElementById('customColorPreview').style.background = '#888888';
  document.getElementById('customColorOverlay').classList.add('open');
}

function closeCustomColor() {
  document.getElementById('customColorOverlay').classList.remove('open');
  _customTarget = null;
}

async function confirmCustomColor() {
  const name  = document.getElementById('customColorName').value.trim();
  const color = document.getElementById('customColorPicker').value;
  if (!name) { showToast('‚ö†Ô∏è Podaj nazwƒô koloru', 'error'); return; }

  if (PALETTE.some(p => p.name.toLowerCase() === name.toLowerCase())) {
    showToast('‚ö†Ô∏è Taki kolor ju≈º istnieje', 'error'); return;
  }

  const btnOk = document.getElementById('customColorOverlay').querySelector('.btn-custom-ok');
  btnOk.disabled = true; btnOk.textContent = '‚è≥...';

  PALETTE.push({ name, color });
  const ok = await saveData();

  btnOk.disabled = false; btnOk.textContent = '‚úÖ Dodaj';

  if (!ok) {
    PALETTE.pop();
    showToast('‚ùå B≈ÇƒÖd zapisu. Sprawd≈∫ token', 'error');
    return;
  }

  const target = _customTarget;
  closeCustomColor();
  showToast(`‚úÖ Kolor "${name}" dodany`, 'success');

  if (target) {
    const { paletteId, colorsListId } = target;

    const currentEntries = [];
    document.querySelectorAll(`#${colorsListId} .color-entry`).forEach(entry => {
      currentEntries.push({
        name:      entry.dataset.colorName,
        color:     entry.dataset.colorHex,
        thickness: entry.querySelector('input[type="number"]').value
      });
    });

    renderPalette(paletteId, colorsListId, []);

    document.getElementById(colorsListId).innerHTML = '';
    currentEntries.forEach(e => addColorEntry(colorsListId, e.name, e.color, e.thickness));

    currentEntries.forEach(e => {
      PALETTE.forEach((p, i) => {
        if (p.name === e.name) {
          document.querySelector(`#${paletteId} .palette-btn[data-index="${i}"]`)?.classList.add('selected');
        }
      });
    });

    addColorEntry(colorsListId, name, color);
    const idx = PALETTE.length - 1;
    document.querySelector(`#${paletteId} .palette-btn[data-index="${idx}"]`)?.classList.add('selected');
  }
}

// ‚îÄ‚îÄ Delete color from palette ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _selectedColorToDelete = null;

function openDeleteColor() {
  _selectedColorToDelete = null;
  const list = document.getElementById('deleteColorList');
  list.innerHTML = '';

  if (!PALETTE.length) {
    list.innerHTML = '<p style="color:#555;text-align:center;font-size:0.85rem;">Brak selekcji do usuniƒôcia</p>';
  } else {
    PALETTE.forEach((p, i) => {
      const item = document.createElement('div');
      item.className = 'delete-color-item';
      item.dataset.index = i;
      item.innerHTML = `
        <div class="delete-color-item-dot" style="background:${p.color}"></div>
        <div class="delete-color-item-name">${p.name}</div>
      `;
      item.addEventListener('click', () => {
        document.querySelectorAll('.delete-color-item').forEach(el => el.classList.remove('selected'));
        item.classList.add('selected');
        _selectedColorToDelete = i;
        document.getElementById('btnConfirmDeleteColor').disabled = false;
      });
      list.appendChild(item);
    });
  }

  document.getElementById('btnConfirmDeleteColor').disabled = true;
  document.getElementById('deleteColorOverlay').classList.add('open');
}

function closeDeleteColor() {
  document.getElementById('deleteColorOverlay').classList.remove('open');
  _selectedColorToDelete = null;
}

async function confirmDeleteColor() {
  if (_selectedColorToDelete === null) return;

  const btnDel = document.getElementById('btnConfirmDeleteColor');
  btnDel.disabled = true; btnDel.textContent = '‚è≥...';

  const removed = PALETTE.splice(_selectedColorToDelete, 1)[0];
  const ok = await saveData();

  btnDel.disabled = false; btnDel.textContent = 'üóëÔ∏è Usu≈Ñ';

  if (!ok) {
    PALETTE.splice(_selectedColorToDelete, 0, removed);
    showToast('‚ùå B≈ÇƒÖd zapisu. Sprawd≈∫ token', 'error');
    return;
  }

  closeDeleteColor();
  showToast(`‚úÖ Selekcja "${removed.name}" usuniƒôta`, 'success');

  // –æ–Ω–æ–≤–ª—é—î–º–æ –ø–∞–ª—ñ—Ç—Ä—É –≤ –æ–±–æ—Ö –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –º–æ–¥–∞–ª—è—Ö
  ['fPalette', 'ePalette'].forEach(paletteId => {
    const el = document.getElementById(paletteId);
    if (!el) return;
    const colorsListId = paletteId === 'fPalette' ? 'fColorsList' : 'eColorsList';

    // –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –∑–∞–ø–∏—Å–∏
    const currentEntries = [];
    document.querySelectorAll(`#${colorsListId} .color-entry`).forEach(entry => {
      if (entry.dataset.colorName !== removed.name) {
        currentEntries.push({
          name:      entry.dataset.colorName,
          color:     entry.dataset.colorHex,
          thickness: entry.querySelector('input[type="number"]').value
        });
      }
    });

    renderPalette(paletteId, colorsListId, []);
    document.getElementById(colorsListId).innerHTML = '';
    currentEntries.forEach(e => addColorEntry(colorsListId, e.name, e.color, e.thickness));
    currentEntries.forEach(e => {
      PALETTE.forEach((p, i) => {
        if (p.name === e.name)
          document.querySelector(`#${paletteId} .palette-btn[data-index="${i}"]`)?.classList.add('selected');
      });
    });
  });
}


  // ‚îÄ‚îÄ Helpers: read tolerances ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function readTol(prefix) {
  return {
    grubosc:         { do: parseFloat(document.getElementById(`${prefix}TgDo`).value) },
    wspolsrodkowosc: { od: parseFloat(document.getElementById(`${prefix}TwOd`).value), do: parseFloat(document.getElementById(`${prefix}TwDo`).value) },
    wysokosc:        { od: parseFloat(document.getElementById(`${prefix}TyOd`).value), do: parseFloat(document.getElementById(`${prefix}TyDo`).value) },
  };
}

  function tolValid(t) {
  return !isNaN(t.grubosc.do) &&
         !isNaN(t.wspolsrodkowosc.od) && !isNaN(t.wspolsrodkowosc.do) &&
         !isNaN(t.wysokosc.od)        && !isNaN(t.wysokosc.do);
}

  function fillTol(prefix, tol) {
  const t = tol || {};
  document.getElementById(`${prefix}TgDo`).value = t.grubosc?.do         ?? '';
  document.getElementById(`${prefix}TwOd`).value = t.wspolsrodkowosc?.od ?? '';
  document.getElementById(`${prefix}TwDo`).value = t.wspolsrodkowosc?.do ?? '';
  document.getElementById(`${prefix}TyOd`).value = t.wysokosc?.od        ?? '';
  document.getElementById(`${prefix}TyDo`).value = t.wysokosc?.do        ?? '';
}


  // ‚îÄ‚îÄ Add Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openModal() {
    if (!currentMachine) { showToast('‚ö†Ô∏è Najpierw wybierz maszynƒô', 'error'); return; }
    if (!token)          { showToast('‚ö†Ô∏è Wprowad≈∫ token w ustawieniach ‚öôÔ∏è', 'error'); return; }
    document.getElementById('modalMachineName').textContent = currentMachine;
    ['fNum','fDiam','fP20','fP25','fP30','fTgDo','fTwOd','fTwDo','fTyOd','fTyDo']
  .forEach(id => document.getElementById(id).value = '');
    document.getElementById('fColorsList').innerHTML = '';
    renderPalette('fPalette', 'fColorsList', []);
    document.getElementById('modalOverlay').classList.add('open');
  }
  function closeModal() { document.getElementById('modalOverlay').classList.remove('open'); }

  async function saveEntry() {
    const num    = document.getElementById('fNum').value.trim();
    const diam   = parseFloat(document.getElementById('fDiam').value);
    const p20    = parseFloat(document.getElementById('fP20').value);
    const p25    = parseFloat(document.getElementById('fP25').value);
    const p30    = parseFloat(document.getElementById('fP30').value);
    const tol    = readTol('f');
    const colors = getColorsFromList('fColorsList');

    if (!num || isNaN(diam) || isNaN(p20) || isNaN(p25) || isNaN(p30)) { showToast('‚ö†Ô∏è Wype≈Çnij wszystkie pola', 'error'); return; }
    if (!tolValid(tol))    { showToast('‚ö†Ô∏è Wype≈Çnij wszystkie tolerancje', 'error'); return; }
    if (colors === null)   { showToast('‚ö†Ô∏è Wype≈Çnij grubo≈õci dla wszystkich selekcji', 'error'); return; }
    if (!colors.length)    { showToast('‚ö†Ô∏è Wybierz przynajmniej jednƒÖ selekcjƒô', 'error'); return; }
    if ([p20,p25,p30].some(p => p > 99)) { showToast('‚ö†Ô∏è Warto≈õƒá nie mo≈ºe przekraczaƒá 99.0', 'error'); return; }
    if (DB[currentMachine][num]) { showToast('‚ö†Ô∏è Taki numer ju≈º istnieje', 'error'); return; }

    const btn = document.getElementById('btnSave');
    btn.disabled = true; btn.textContent = '‚è≥ Zapisujƒô...';
    DB[currentMachine][num] = { diameter: diam, prices: [p20,p25,p30], tolerancje: tol, colors };
    const ok = await saveData();
    btn.disabled = false; btn.textContent = 'üíæ Zapisz';

    if (ok) { closeModal(); showToast(`‚úÖ Numer ${num} zapisany`, 'success'); }
    else    { delete DB[currentMachine][num]; showToast('‚ùå B≈ÇƒÖd. Sprawd≈∫ token', 'error'); }
  }

  // ‚îÄ‚îÄ Edit Modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openEditModal(id) {
    const item = DB[currentMachine][id];
    if (!item) return;
    document.getElementById('editModalMachine').textContent = currentMachine;
    document.getElementById('eOrigNum').value = id;
    document.getElementById('eNum').value     = id;
    document.getElementById('eDiam').value    = item.diameter;
    document.getElementById('eP20').value     = item.prices[0];
    document.getElementById('eP25').value     = item.prices[1];
    document.getElementById('eP30').value     = item.prices[2];
    fillTol('e', item.tolerancje);

    const list = document.getElementById('eColorsList');
    list.innerHTML = '';
    const saved = item.colors || [];
    renderPalette('ePalette', 'eColorsList', saved);
    saved.forEach(c => {
      addColorEntry('eColorsList', c.name, c.color || '#888888', c.thickness);
      PALETTE.forEach((p, i) => {
        if (p.name === c.name)
          document.querySelector(`#ePalette .palette-btn[data-index="${i}"]`)?.classList.add('selected');
      });
    });

    document.getElementById('editModalOverlay').classList.add('open');
  }
  function closeEditModal() { document.getElementById('editModalOverlay').classList.remove('open'); }

  async function saveEdit() {
    const origNum = document.getElementById('eOrigNum').value;
    const newNum  = document.getElementById('eNum').value.trim();
    const diam    = parseFloat(document.getElementById('eDiam').value);
    const p20     = parseFloat(document.getElementById('eP20').value);
    const p25     = parseFloat(document.getElementById('eP25').value);
    const p30     = parseFloat(document.getElementById('eP30').value);
    const tol     = readTol('e');
    const colors  = getColorsFromList('eColorsList');

    if (!newNum || isNaN(diam) || isNaN(p20) || isNaN(p25) || isNaN(p30)) { showToast('‚ö†Ô∏è Wype≈Çnij wszystkie pola', 'error'); return; }
    if (!tolValid(tol))    { showToast('‚ö†Ô∏è Wype≈Çnij wszystkie tolerancje', 'error'); return; }
    if (colors === null)   { showToast('‚ö†Ô∏è Wype≈Çnij grubo≈õci dla wszystkich selekcji', 'error'); return; }
    if (!colors.length)    { showToast('‚ö†Ô∏è Wybierz przynajmniej jednƒÖ selekcjƒô', 'error'); return; }
    if ([p20,p25,p30].some(p => p > 99)) { showToast('‚ö†Ô∏è Warto≈õƒá nie mo≈ºe przekraczaƒá 99.0', 'error'); return; }
    if (newNum !== origNum && DB[currentMachine][newNum]) { showToast('‚ö†Ô∏è Taki numer ju≈º istnieje', 'error'); return; }

    const btn = document.getElementById('btnEditSave');
    btn.disabled = true; btn.textContent = '‚è≥ Zapisujƒô...';
    const oldData = { ...DB[currentMachine][origNum] };
    delete DB[currentMachine][origNum];
    DB[currentMachine][newNum] = { diameter: diam, prices: [p20,p25,p30], tolerancje: tol, colors };
    const ok = await saveData();
    btn.disabled = false; btn.textContent = 'üíæ Zapisz zmiany';

    if (ok) {
      closeEditModal();
      showToast(`‚úÖ Numer ${newNum} zaktualizowany`, 'success');
      selectResult(newNum, DB[currentMachine][newNum]);
      document.getElementById('searchInput').value = newNum;
    } else {
      delete DB[currentMachine][newNum];
      DB[currentMachine][origNum] = oldData;
      showToast('‚ùå B≈ÇƒÖd zapisu', 'error');
    }
  }

  // ‚îÄ‚îÄ Delete ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let pendingDeleteId = null;
  function openConfirm(id) {
    pendingDeleteId = id;
    document.getElementById('confirmNum').textContent     = `#${id}`;
    document.getElementById('confirmMachine').textContent = currentMachine;
    document.getElementById('confirmOverlay').classList.add('open');
  }
  function closeConfirm() { pendingDeleteId = null; document.getElementById('confirmOverlay').classList.remove('open'); }

  async function confirmDelete() {
    if (!pendingDeleteId) return;
    const id = pendingDeleteId;
    const backup = { ...DB[currentMachine][id] };
    delete DB[currentMachine][id];
    closeConfirm();
    showToast('‚è≥ Usuwam...', '');
    const ok = await saveData();
    if (ok) {
      document.getElementById('results').innerHTML = '<p class="hint">Wpis usuniƒôty. Wpisz nowy numer.</p>';
      document.getElementById('searchInput').value = '';
      showToast(`‚úÖ Numer ${id} usuniƒôty`, 'success');
    } else {
      DB[currentMachine][id] = backup;
      showToast('‚ùå B≈ÇƒÖd usuwania', 'error');
    }
  }

  // ‚îÄ‚îÄ SVG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function bushingIcon() {
    return `<svg class="bushing-icon" viewBox="0 0 60 44" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="mg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#d0d8e8"/><stop offset="40%" stop-color="#a8b4c8"/><stop offset="100%" stop-color="#6a7a90"/></linearGradient>
        <linearGradient id="ig" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#8a9ab0"/><stop offset="100%" stop-color="#4a5a6e"/></linearGradient>
        <linearGradient id="sg" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="rgba(255,255,255,0.45)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></linearGradient>
      </defs>
      <path d="M 4,34 A 26,26 0 0,1 56,34 L 48,34 A 18,18 0 0,0 12,34 Z" fill="url(#mg)" stroke="#8a9ab0" stroke-width="0.8"/>
      <rect x="4" y="34" width="8" height="6" rx="1" fill="url(#ig)" stroke="#6a7a90" stroke-width="0.5"/>
      <rect x="48" y="34" width="8" height="6" rx="1" fill="url(#ig)" stroke="#6a7a90" stroke-width="0.5"/>
      <rect x="4" y="40" width="52" height="3" rx="1.5" fill="#5a6a80" stroke="#4a5a6e" stroke-width="0.5"/>
      <path d="M 8,34 A 22,22 0 0,1 52,34 L 48,34 A 18,18 0 0,0 12,34 Z" fill="url(#sg)" opacity="0.6"/>
      <path d="M 6,26 A 24,24 0 0,1 54,26" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1.2" stroke-linecap="round"/>
    </svg>`;
  }

  // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showToast(msg, type = '') {
    const t = document.getElementById('toast');
    t.textContent = msg; t.className = `toast ${type} show`;
    setTimeout(() => t.classList.remove('show'), 3000);
  }

  // ‚îÄ‚îÄ Listeners ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.addEventListener('click', e => {
    if (!document.getElementById('searchWrap').contains(e.target))
      document.getElementById('dropdown').innerHTML = '';
  });


  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if (localStorage.getItem('gss_token')) {
    token = localStorage.getItem('gss_token');
    document.getElementById('cfgToken').value = token;
  }
  loadData();
</script>
</body>
</html>
